!function(){class t{constructor(){this.start=Date.now(),this.m={ph:0,pc:0,pa:0,it:0,ia:0,dr:0,bs:0,uh:0,bh:0,ts:0,ff:0,td:0,cc:0,ms:0,ct:false,rc:false,mm:false,sp:false,rd:false,cd:false,tv:[],sv:0,cp:[],mj:0,dw:{},cbd:0,pm:false,gv:false,rr:0,spv:false,pmh:false,sbv:false,fs:false,fa:false,tp:0,sd:0,rv:false,vc:0,h:new Date().getHours(),d:new Date().getDay()},this.s={e:"neutral",ip:"browsing",c:0,pp:0,iv:null},this.lm={x:0,y:0,t:Date.now()},this.sh=[],this.mt=[],this.ct=[],this.tt=[],this.ae=null,this.vc=[],this.init()}init(){this.ld(),this.autoDetect(),this.track(),this.loop()}ld(){const e=localStorage.getItem("u");if(e){const t=JSON.parse(e);this.h=t.s||[],this.w=t.w||this.dw()}else this.h=[],this.w=this.dw();const t=localStorage.getItem("lv"),s=parseInt(localStorage.getItem("vc")||"0");t&&(this.m.rv=true,this.m.vc=s+1,(Date.now()-parseInt(t))/864e5<1&&(this.s.ip="considering")),localStorage.setItem("vc",this.m.vc.toString()),localStorage.setItem("lv",Date.now().toString())}dw(){return{b:-3.5,ph:2.5,pa:3,it:1.8,dr:2.2,uh:-1.5,ts:-1.2,ff:-2,td:-1.8,ms:-1,cr:4,mm:3.5,ds:2.8,ce:2,he:-1.5,fe:-2.5,ee:3,cd:4.5,gv:2,rr:1.5,sp:2.5,pmh:3.5,sbv:1.8,fs:5,rv:1.5,tp:.5,sd:1,hw:[.3,.2,.1,.1,.2,.3,.5,.7,.9,.8,.7,.8,.9,.7,.6,.7,.8,.9,1,1.1,1,.8,.6,.4],dw:[.6,.8,.9,.9,.9,.7,.5]}}autoDetect(){const e=document.querySelector('button[type="submit"]')||document.querySelector("button");e&&(e.dataset.buyButton="");const t=document.querySelector('input[name="price"], [class*="price"], [id*="price"]');t&&(t.dataset.price="");const s=document.querySelector("img");s&&(s.dataset.productImage="");document.querySelectorAll("iframe").forEach((e=>{e.src.includes("stripe")&&(this.m.fs=true,this.s.ip="committed")}))}te(e,t){const s=document.querySelector(e);if(!s)return;let i=null;t.onHover&&(s.addEventListener("mouseenter",(()=>{i=Date.now()})),s.addEventListener("mouseleave",(()=>{if(i){const e=Date.now()-i;t.onHover(e),i=null}}))),t.onClick&&s.addEventListener("click",t.onClick),t.onVisible&&new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&t.onVisible()}))}),{threshold:.5}).observe(s),t.onHighlight&&document.addEventListener("selectionchange",(()=>{const e=window.getSelection();e.anchorNode&&s.contains(e.anchorNode)&&e.toString().length>0&&t.onHighlight()}))}tsb(e,t){const s=document.querySelector(e);if(!s)return;let i=0,n=0;new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const e=Date.now();e-n>3e3&&(i++,i>1&&t()),n=e}}))}),{threshold:.3}).observe(s)}track(){this.te("[data-price]",{onHover:e=>{this.m.ph+=e,this.m.pc++,e>2e3&&(this.m.mm=true)},onHighlight:()=>{this.m.pa++,this.m.mm=true}}),this.te("[data-product-image]",{onHover:e=>{this.m.it+=e,e>3e3&&(this.s.e="excited")},onClick:()=>{this.m.ia++}}),this.tsb("[data-description]",(()=>{this.m.dr++})),this.tsb("[data-benefits]",(()=>{this.m.bs++})),this.te("[data-buy-button]",{onHover:e=>{this.m.cbd+=e,e>1500&&(this.s.ip="deciding")}}),this.te("[data-reviews]",{onVisible:()=>{this.m.rr++}}),this.te("[data-guarantee]",{onVisible:()=>{this.m.gv=true}}),this.te("[data-social-proof]",{onVisible:()=>{this.m.spv=true}}),this.te("[data-security]",{onVisible:()=>{this.m.sbv=true}});let e=0;document.addEventListener("mousemove",(t=>{t.clientY<50&&e>=50&&(this.m.uh++,this.s.e="hesitant"),e=t.clientY})),document.addEventListener("visibilitychange",(()=>{document.hidden?(this.m.ts++,this.vc.push(Date.now()),setTimeout((()=>{document.hidden||(this.m.rc=true)}),100)):this.m.tp+=(Date.now()-this.start)/1e3})),document.addEventListener("focus",(e=>{("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName)&&(this.ae=e.target,this.m.fs=true)}),true),document.addEventListener("blur",(e=>{e.target===this.ae&&0===e.target.value.length&&(this.m.ff++,this.s.e="hesitant")}),true),document.addEventListener("input",(e=>{if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName){const t=e.target.value;"deleteContentBackward"===e.inputType?(this.tt.push({type:"delete",time:Date.now()}),this.tt.filter((e=>Date.now()-e.time<2e3&&"delete"===e.type)).length>3&&(this.m.td++,this.s.e="hesitant")):this.tt.push({type:"type",time:Date.now()})}})),document.addEventListener("mousemove",(e=>{this.mt.push({x:e.clientX,y:e.clientY,time:Date.now()}),this.mt.length>20&&this.mt.shift(),20===this.mt.length&&this.dcm(this.mt)&&(this.m.cc++,this.s.e="hesitant")})),window.history.length>1&&document.addEventListener("mousemove",(e=>{e.clientX<100&&e.clientY<100&&this.m.bh++}));let t=Date.now();document.addEventListener("keydown",(e=>{const s=Date.now(),i=s-t;i<2e3&&(this.m.tv.push(i),this.m.tv.length>20&&this.m.tv.shift(),this.m.tv.length>=10&&(this.m.tv.reduce(((e,t)=>e+t),0)/this.m.tv.length<100?this.s.e="frustrated":this.m.tv.reduce(((e,t)=>e+t),0)/this.m.tv.length>300?this.s.e="hesitant":this.s.e="confident")),t=s}));let s=Date.now(),i=window.scrollY;window.addEventListener("scroll",(()=>{const e=Date.now(),t=window.scrollY,n=e-s,r=Math.abs(t-i);if(n>0){const e=r/n;this.sh.push(e),this.sh.length>20&&this.sh.shift(),this.sh.length>=10&&(this.sh.reduce(((e,t)=>e+t),0)/this.sh.length,this.sh.reduce(((e,t)=>e+Math.pow(t-(this.sh.reduce(((e,t)=>e+t),0)/this.sh.length),2),0)/this.sh.length>.5?this.s.e="frustrated":this.sh.reduce(((e,t)=>e+t),0)/this.sh.length<.1&&(this.m.cd=true,this.s.e="confident"))}s=e,i=t;const o=(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight))*100;this.m.sd=Math.max(this.m.sd,o)}));let n=0;document.addEventListener("mousedown",(()=>{n=Date.now()})),document.addEventListener("mouseup",(()=>{if(n){const e=Date.now()-n;this.m.cp.push(e),this.m.cp.length>10&&this.m.cp.shift(),e>300&&(this.s.e="frustrated")}})),document.addEventListener("click",(e=>{this.ct.push(Date.now()),this.ct=this.ct.filter((e=>Date.now()-e<5e3)),this.ct.length>5&&(this.m.rd=true,this.s.e="frustrated")})),document.addEventListener("mousemove",(e=>{const t=Date.now(),s=t-this.lm.t;s>0&&s<50&&Math.sqrt(Math.pow(e.clientX-this.lm.x,2)+Math.pow(e.clientY-this.lm.y,2))<10&&this.m.mj++,this.lm={x:e.clientX,y:e.clientY,time:t}})),new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{"IFRAME"===e.nodeName&&(this.m.fs=true,this.s.ip="committed")}))}))})).observe(document.body,{childList:true,subtree:true}),window.addEventListener("beforeunload",(()=>{this.m.fs&&!this.m.fa&&(this.m.fa=true)})),setInterval((()=>{this.m.pc>0&&this.m.sd>60&&(this.m.gv||this.m.spv)&&(this.s.ip="committed"),this.m.it>5e3&&this.m.cd&&this.m.tp>30&&(this.s.e="excited",this.s.ip="deciding")}),2e3)}dcm(e){const t=e[0],s=e[e.length-1];return Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2))<50}cp(){const e=this.w,t=this.m;let s=e.b;s+=Math.min(t.ph/5e3,1)*e.ph,s+=Math.min(t.pa/3,1)*e.pa,s+=Math.min(t.it/1e4,1)*e.it,s+=Math.min(t.dr/3,1)*e.dr,s+=Math.min(t.uh/5,1)*e.uh,s+=Math.min(t.ts/3,1)*e.ts,s+=Math.min(t.ff/3,1)*e.ff,s+=Math.min(t.td/5,1)*e.td,s+=Math.min(t.ms/10,1)*e.ms,t.rc&&(s+=e.cr),t.mm&&(s+=e.mm),t.sp&&(s+=e.ds);const i={confident:e.ce,hesitant:e.he,frustrated:e.fe,excited:e.ee};s+=(i[this.s.e]||0),s+=Math.min(t.cbd/3e3,1)*e.cd,t.gv&&(s+=e.gv),s+=Math.min(t.rr/3,1)*e.rr,t.spv&&(s+=e.sp),t.pmh&&(s+=e.pmh),t.sbv&&(s+=e.sbv),t.fs&&(s+=e.fs),t.rv&&(s+=e.rv*t.vc),s+=Math.min(t.tp/300,1)*e.tp,s+=t.sd/100*e.sd,s+=e.hw[t.h]*.5,s+=e.dw[t.d]*.5;return 1/(1+Math.exp(-s))}dip(){const e=this.s.pp;return e<.2?"browsing":e<.4?"considering":e<.7?"deciding":"committed"}loop(){setInterval((()=>{this.m.tp=(Date.now()-this.start)/1e3,this.s.pp=this.cp(),this.s.ip=this.dip(),this.s.c=this.cc(),window.dispatchEvent(new CustomEvent("hyperPredict",{detail:{probability:this.s.pp,intentPhase:this.s.ip,emotion:this.s.e,confidence:this.s.c,metrics:this.m}})),this.oi()}),1e3),setInterval((()=>{this.s.iv=this.di(),this.ei()}),2e3)}cc(){let e=0;return this.m.pc>0&&e++,this.m.sd>50&&e++,this.m.it>1e3&&e++,this.m.tp>20&&e++,this.m.cbd>0&&e++,this.m.rv&&e++,this.h.length>10&&(e+=2),Math.min(e/8,1)}di(){const e=this.s.pp,t=this.s.e,s=this.s.ip;return"frustrated"===t?{type:"reduce_friction",message:"Simplify checkout, reduce form fields",action:"calm"}:"hesitant"===t&&"deciding"===s?{type:"address_objections",message:"Show guarantee, reduce risk",action:"reassure"}:this.m.rc?{type:"emphasize_value",message:"Highlight unique benefits, show social proof",action:"differentiate"}:e>.7&&!this.m.fs?{type:"create_urgency",message:"Limited time offer, scarcity",action:"push"}:"excited"===t&&"committed"===s?{type:"remove_friction",message:"Clear path to checkout, one-click buy",action:"facilitate"}:e<.3&&"browsing"===s?{type:"educate",message:"Show benefits, build value",action:"engage"}:null}ei(){const e=this.s.iv;if(!e)return;switch(e.type){case"reduce_friction":this.rf();break;case"address_objections":this.ao();break;case"emphasize_value":this.ev();break;case"create_urgency":this.cu();break;case"remove_friction":this.fc();break;case"educate":this.ed()}}rf(){document.querySelectorAll("[data-hide-on-frustration]").forEach((e=>{e.style.transition="opacity 0.5s ease",e.style.opacity="0.2",e.style.pointerEvents="none"})),document.querySelectorAll("[data-optional-field]").forEach((e=>{e.style.display="none"}));const e=document.querySelector("[data-express-checkout]");e&&(e.style.display="block",e.style.animation="pulse 1s ease-in-out")}ao(){const e=document.querySelector("[data-guarantee]");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.style.border="2px solid #10b981",e.style.padding="16px",e.style.animation="highlight 1s ease-in-out");const t=document.querySelector("[data-trust-signals]");t&&(t.style.display="block");const s=document.querySelector("[data-risk-free]");s&&(s.innerHTML="Money-Back Guarantee - Secure Checkout",s.style.display="block",s.style.color="#10b981",s.style.fontWeight="bold")}ev(){const e=document.querySelector("[data-usp]");e&&(e.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",e.style.color="white",e.style.padding="24px",e.style.borderRadius="12px",e.style.transform="scale(1.02)",e.style.transition="all 0.3s ease");const t=document.querySelector("[data-social-proof]");t&&(t.style.display="block",t.scrollIntoView({behavior:"smooth",block:"center"}));const s=document.querySelector("[data-value-prop]");s&&(s.style.fontSize="1.2em",s.style.fontWeight="600",s.style.color="#1f2937")}cu(){const e=document.querySelector("[data-urgency]");if(e&&!e.classList.contains("active")){e.classList.add("active");const t=["Only 3 left in stock","12 people viewing this now","Sale ends in 2 hours","Limited time offer"][Math.floor(4*Math.random())];e.innerHTML=t,e.style.display="block",e.style.background="#fef3c7",e.style.padding="12px 24px",e.style.borderRadius="8px",e.style.fontWeight="600",e.style.textAlign="center",e.style.animation="slideDown 0.5s ease-out"}const t=document.querySelector("[data-buy-button]");t&&(t.style.animation="pulse 2s infinite",t.style.boxShadow="0 0 20px rgba(16, 185, 129, 0.5)")}fc(){document.querySelectorAll("[data-non-essential]").forEach((e=>{e.style.opacity="0",e.style.pointerEvents="none"}));const e=document.querySelector("[data-checkout-area]");e&&(e.style.filter="none",e.scrollIntoView({behavior:"smooth",block:"center"}));const t=document.querySelector("[data-buy-button]");t&&(t.style.transform="scale(1.05)",t.style.transition="transform 0.3s ease")}ed(){const e=document.querySelector("[data-benefits]");e&&this.m.sd<40&&setTimeout((()=>{e.scrollIntoView({behavior:"smooth",block:"start"})}),3e3),document.querySelectorAll("[data-feature]").forEach(((e,t)=>{setTimeout((()=>{e.style.border="2px solid #3b82f6",e.style.padding="12px",e.style.borderRadius="8px",e.style.transition="all 0.3s ease",setTimeout((()=>{e.style.border="none"}),2e3)}),1e3*t)}))}oi(){const e=this.s.pp;e<.3&&this.m.tp>10?this.cu():e>=.3&&e<.6?this.ea():e>=.6&&this.fc()}ea(){const e=document.querySelector("[data-buy-button]");e&&!e.classList.contains("highlighted")&&(e.classList.add("highlighted"),e.style.transform="scale(1.02)",e.style.transition="transform 0.3s ease")}rs(e=false){const t={metrics:{...this.m},finalState:{...this.s},purchased:e,timestamp:Date.now(),sessionDuration:this.m.tp};this.h.push(t),this.h.length>100&&this.h.shift(),this.h.length>=10&&this.tm(),this.sd()}tm(){const e=.01;for(let t=0;t<100;t++)this.h.forEach((t=>{const s=this.pfm(t.metrics),i=(t.purchased?1:0)-s,n=this.nm(t.metrics),r=this.w;r.b+=e*i,r.ph+=e*i*n.ph,r.pa+=e*i*n.pa,r.it+=e*i*n.it,r.dr+=e*i*n.dr,r.uh+=e*i*n.uh,r.ts+=e*i*n.ts,r.ff+=e*i*n.ff,r.td+=e*i*n.td,r.cd+=e*i*n.cbd,r.rv+=e*i*(t.metrics.rv?1:0)}))}nm(e){return{ph:Math.min(e.ph/5e3,1),pa:Math.min(e.pa/3,1),it:Math.min(e.it/1e4,1),dr:Math.min(e.dr/3,1),uh:Math.min(e.uh/5,1),ts:Math.min(e.ts/3,1),ff:Math.min(e.ff/3,1),td:Math.min(e.td/5,1),cbd:Math.min(e.cbd/3e3,1)}}pfm(e){const t=this.w,s=this.nm(e);let i=t.b;return i+=s.ph*t.ph,i+=s.pa*t.pa,i+=s.it*t.it,i+=s.dr*t.dr,i+=s.uh*t.uh,i+=s.ts*t.ts,i+=s.ff*t.ff,i+=s.td*t.td,i+=s.cbd*t.cd,e.rv&&(i+=t.rv),1/(1+Math.exp(-i))}sd(){localStorage.setItem("u",JSON.stringify({s:this.h,w:this.w}))}ga(){return{probability:(100*this.s.pp).toFixed(1)+"%",intentPhase:this.s.ip,emotion:this.s.e,confidence:(100*this.s.c).toFixed(0)+"%",intervention:this.s.iv,metrics:this.m,insights:this.gi()}}gi(){const e=[],t=this.m;return t.pa>0&&e.push("User is calculating affordability"),t.it>5e3&&e.push("Strong visual engagement - imagining ownership"),t.dr>1&&e.push("Carefully evaluating product details"),t.rc&&e.push("User is price comparing - emphasize unique value"),t.uh>2&&e.push("Exit risk detected - considering leaving"),t.cbd>2e3&&e.push("High purchase intent - hovering on checkout"),"frustrated"===this.s.e&&e.push("User frustrated - simplify experience"),t.gv&&t.spv&&e.push("Trust signals viewed - objections being addressed"),t.fs&&e.push("CRITICAL: User has started checkout process!"),e}reset(){localStorage.removeItem("u"),localStorage.removeItem("lv"),localStorage.removeItem("vc"),console.log("All prediction data cleared")}pa(){const e=this.s.pp,t=this.s.ip;return"browsing"===t&&e<.3?"Will scroll to reviews next":"considering"===t&&this.m.pc>0?"Will check guarantee/return policy":"deciding"===t&&e>.5?"Will click buy button within 30 seconds":"committed"===t?"Ready to purchase - remove friction":"Observing behavior patterns..."}}const e=new t;window.addEventListener("hyperPredict",(t=>{const s=t.detail;console.log("UPOAP Analysis:"),console.log("Purchase Probability: "+(100*s.probability).toFixed(1)+"%"),console.log("Intent Phase: "+s.intentPhase),console.log("Emotional State: "+s.emotion),console.log("Confidence: "+(100*s.confidence).toFixed(0)+"%");const i=document.querySelector("[data-prediction-debug]");if(i){const t=e.ga();i.innerHTML=`\n      <div style="font-family: monospace; background: #1f2937; color: #10b981; padding: 16px; border-radius: 8px; font-size: 12px;">\n        <div style="margin-bottom: 12px; font-size: 14px; font-weight: bold;">UPOAP Analytics</div>\n        <div>Purchase Probability: <span style="color: #fbbf24;">${t.probability}</span></div>\n        <div>Intent Phase: <span style="color: #60a5fa;">${t.intentPhase}</span></div>\n        <div>Emotion: <span style="color: #f472b6;">${t.emotion}</span></div>\n        <div>Confidence: <span style="color: #34d399;">${t.confidence}</span></div>\n        <div>Next Action: <span style="color: #a78bfa;">${e.pa()}</span></div>\n        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #374151;">\n          <div style="font-weight: bold; margin-bottom: 4px;">Insights:</div>\n          ${t.insights.map((e=>`<div style="margin-left: 8px;">- ${e}</div>`)).join("")}\n        </div>\n        ${t.intervention?`\n          <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #374151;">\n            <div style="font-weight: bold;">Active Intervention:</div>\n            <div style="margin-left: 8px; color: #fbbf24;">${t.intervention.message}</div>\n          </div>\n        `:""}\n      </div>\n    `}})),window.recordPurchase=function(){e.rs(true),console.log("Purchase recorded. Model learning from conversion patterns.")},window.addEventListener("beforeunload",(()=>{e.m.tp>10&&e.rs(false)})),window.upoap=e;const s=document.createElement("style");s.textContent="\n  @keyframes pulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.05); }\n  }\n  \n  @keyframes highlight {\n    0%, 100% { background: transparent; }\n    50% { background: rgba(16, 185, 129, 0.1); }\n  }\n  \n  @keyframes slideDown {\n    from { transform: translateY(-20px); opacity: 0; }\n    to { transform: translateY(0); opacity: 1; }\n  }\n",document.head.appendChild(s),console.log("UPOAP Engine Active"),console.log("Commands:"),console.log("- upoap.getAnalysis() for full analysis"),console.log("- upoap.predictNextAction() for behavior prediction"),console.log("- upoap.reset() to clear all data"),console.log("- window.recordPurchase() to record successful conversions")}();