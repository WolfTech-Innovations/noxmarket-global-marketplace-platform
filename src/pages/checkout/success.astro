---
// src/pages/checkout/success.astro
import Layout from '@/layouts/Layout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import { getSessionFromCookies } from '@/lib/auth';

const session = getSessionFromCookies(Astro.cookies);
const sessionId = Astro.url.searchParams.get('session_id');

if (!session) {
  return Astro.redirect('/login');
}
---

<Layout title="Order Successful - Nox">
  <Header />

  <main class="py-16 min-h-screen bg-gradient-to-br from-green-50 to-emerald-50">
    <div class="container-custom max-w-3xl">
      <div class="card-elevated p-12 text-center">
        <!-- Success Animation -->
        <div class="mb-8 relative inline-block">
          <div class="w-32 h-32 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center mx-auto elevation-3">
            <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-40 h-40 bg-green-500/20 rounded-full blur-2xl animate-pulse"></div>
          </div>
        </div>

        <!-- Success Message -->
        <h1 class="text-5xl font-bold text-gray-900 mb-4">
          Order Successful! ðŸŽ‰
        </h1>
        <p class="text-xl text-gray-700 mb-2">
          Thank you for your purchase, {session.name}!
        </p>
        <p class="text-gray-600 mb-8">
          Your order has been confirmed and the seller has been notified.
        </p>

        <!-- Order Details Card -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-8 mb-8 text-left">
          <div class="flex items-center gap-3 mb-6">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h2 class="text-2xl font-semibold text-gray-900">What's Next?</h2>
          </div>
          
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
                1
              </div>
              <div>
                <p class="font-semibold text-gray-900">Order Confirmation Email</p>
                <p class="text-sm text-gray-600">Check your inbox at <span class="font-medium">{session.email}</span> for order details and receipt.</p>
              </div>
            </div>

            <div class="flex items-start gap-3">
              <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
                2
              </div>
              <div>
                <p class="font-semibold text-gray-900">Seller Prepares Shipment</p>
                <p class="text-sm text-gray-600">The seller will carefully package and ship your component. You'll receive tracking info soon.</p>
              </div>
            </div>

            <div class="flex items-start gap-3">
              <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
                3
              </div>
              <div>
                <p class="font-semibold text-gray-900">Delivery & Review</p>
                <p class="text-sm text-gray-600">Once you receive your component, leave a review to help other buyers!</p>
              </div>
            </div>
          </div>
        </div>

        {sessionId && (
          <div class="mb-8 p-4 bg-gray-50 rounded-xl">
            <p class="text-xs text-gray-500 mb-1">Order Reference</p>
            <p class="font-mono text-sm text-gray-700">{sessionId}</p>
          </div>
        )}

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/products" class="btn btn-primary text-lg px-8">
            Continue Shopping
          </a>
          <a href="/dashboard" class="btn btn-secondary text-lg px-8">
            View Orders
          </a>
        </div>

        <!-- Support -->
        <div class="mt-8 pt-8 border-t border-gray-200">
          <p class="text-sm text-gray-600">
            Need help? <a href="/support" class="text-blue-600 font-medium hover:underline">Contact our support team</a>
          </p>
        </div>
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<style>
  @keyframes scaleIn {
    from {
      transform: scale(0.8);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  h1 {
    animation: scaleIn 0.5s ease-out;
  }
</style>