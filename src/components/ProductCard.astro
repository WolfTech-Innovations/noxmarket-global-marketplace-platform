---
import type { Product } from '@/types';

export interface Props {
  product: Product;
}

const { product } = Astro.props;

if (!product) {
  return null;
}

const image = product.metadata.product_images?.[0];
const imageUrl = image ? `${image.imgix_url}?w=600&h=600&fit=crop&auto=format,compress` : '';
const price = product.metadata.price ? `$${product.metadata.price.toFixed(2)}` : 'N/A';
const inStock = product.metadata.in_stock;
---

<div class="card animate-fade-in hover:scale-[1.02] transition-transform duration-300">
  <a href={`/products/${product.slug}`} class="block">
    {imageUrl && (
      <div class="relative aspect-square overflow-hidden bg-gray-100">
        <img 
          src={imageUrl}
          alt={product.metadata.product_name}
          class="w-full h-full object-cover"
          width="300"
          height="300"
        />
        {!inStock && (
          <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
            <span class="text-white font-bold text-lg">Out of Stock</span>
          </div>
        )}
      </div>
    )}
    
    <div class="p-4">
      <h3 class="font-bold text-lg mb-2 line-clamp-2">{product.metadata.product_name}</h3>
      
      <div class="flex items-center justify-between">
        <span class="text-2xl font-bold text-accent">{price}</span>
        {inStock && (
          <span class="text-xs text-green-600 font-medium">In Stock</span>
        )}
      </div>
      
      {product.metadata.seller && (
        <p class="text-sm text-gray-600 mt-2">
          by {product.metadata.seller.metadata?.business_name || product.metadata.seller.title}
        </p>
      )}
    </div>
  </a>
</div>